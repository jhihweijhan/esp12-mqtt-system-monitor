# ESP12-Blink 圖文安裝與使用指南

這份指南給第一次接觸專案的使用者。  
你可以照順序一步一步做，不需要先了解全部細節。

## 目錄

1. 安裝前準備
2. 硬體確認
3. 燒錄韌體
4. 啟動 Sender（Docker Compose）
5. 設定 ESP WebUI
6. 驗證是否成功
7. 常見故障排除

## 1) 安裝前準備

### 必備

- 一台 ESP12 顯示模組（已接好電源與螢幕）
- 一台 Linux/Ubuntu 電腦（建議）
- 可連線的 MQTT broker
- USB 線（燒錄用）

### 軟體

- PlatformIO（用來編譯/燒錄韌體）
- Docker + Docker Compose（用來常駐 Sender）
- Git

## 2) 硬體確認（型號）

請確認你的組件型號對應如下：

| 元件 | 型號 |
|---|---|
| LCD | `BL-A54038P-02` |
| Wi-Fi 模組 | `ESP-12F` |

## 3) 燒錄韌體

在專案根目錄執行：

```bash
cd apps/firmware
~/.platformio/penv/bin/pio run
~/.platformio/penv/bin/pio run -t upload
~/.platformio/penv/bin/pio device monitor --baud 115200
```

如果上傳序列埠錯誤，請先檢查 `apps/firmware/platformio.ini` 的 `upload_port`。

## 4) 啟動 Sender（Docker Compose，推薦）

回到專案根目錄後：

```bash
cd apps/sender/python
chmod +x senderctl.sh
./senderctl.sh quickstart-compose
```

第一次會進入設定精靈，請輸入：

- MQTT 主機（例如 `192.168.5.33`）
- MQTT 連接埠（通常 `1883`）
- MQTT 帳號/密碼
- 主機名稱（會顯示在 ESP 上）

常用管理命令：

```bash
./senderctl.sh compose-status
./senderctl.sh compose-logs
./senderctl.sh compose-restart
```

要確保重開機後自動啟動：

```bash
./senderctl.sh ensure-docker-boot
```

## 5) 設定 ESP WebUI

1. 讓 ESP 與你的 broker 在同網段（或可互通）。
2. 打開 ESP 顯示的 IP，例如：`http://192.168.x.x/monitor`
3. 在 MQTT 區塊設定：
   - Server：你的 broker IP
   - Port：1883（或你的設定）
   - User / Pass：與 Sender 相同權限
   - Topic：`sys/agents/+/metrics/v2`

## 6) 驗證是否成功

成功時通常會看到：

- 螢幕底部顯示 `MQTT OK`
- CPU / RAM / GPU 資料持續更新
- API 狀態可回應（範例）：

```bash
curl http://<esp-ip>/api/v2/status
```

執行中的畫面示例：

![執行畫面](../images/runtime-screen.jpeg)

## 7) 常見故障排除

### 問題 A：螢幕顯示 `MQTT --`

- 檢查 broker 位址是否可從 ESP 連到
- 檢查 MQTT 帳密是否正確
- 查看 Sender 日誌：`./senderctl.sh compose-logs`

### 問題 B：有溫度但 GPU 使用率常是 `0%`

這通常代表 GPU 當下空閒，不一定是錯誤。  
可在主機端執行 GPU 工作（例如影片編碼）觀察是否上升。

### 問題 C：Docker 啟動正常，但 ESP 沒收到資料

- 確認 Sender 的 hostname 與 topic 正確
- 確認 ESP 的訂閱 topic 為 `sys/agents/+/metrics/v2`
- 檢查 broker 是否有 ACL 限制
